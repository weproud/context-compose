version: 1
kind: action
name: Rollback
description: Safe rollback procedures for deployments and critical changes
prompt: Execute safe rollback procedures with validation and monitoring
enhanced-prompt: |-
  **Execute safe rollback procedures with comprehensive validation and monitoring.**

  ## Rollback Objectives
  1. **System Recovery:**
     - Restore system to previous stable state
     - Minimize downtime and service disruption
     - Preserve data integrity during rollback
     - Ensure complete functionality restoration

  2. **Risk Mitigation:**
     - Validate rollback safety before execution
     - Monitor system health during rollback
     - Implement circuit breakers for critical failures
     - Maintain audit trail of rollback actions

  ## Rollback Types
  1. **Deployment Rollback:**
     - Application version rollback
     - Database schema rollback
     - Configuration rollback
     - Infrastructure rollback

  2. **Code Rollback:**
     - Git commit reversion
     - Branch rollback
     - Merge rollback
     - Feature flag rollback

  3. **Data Rollback:**
     - Database restoration
     - File system rollback
     - Cache invalidation
     - State restoration

  ## Pre-rollback Validation
  1. **Impact Assessment:**
     - Identify affected systems and components
     - Assess data loss risks
     - Evaluate user impact and downtime
     - Check dependencies and integrations

  2. **Rollback Feasibility:**
     - Verify rollback target availability
     - Check backup integrity and completeness
     - Validate rollback procedures and scripts
     - Ensure necessary permissions and access

  3. **Safety Checks:**
     - Confirm rollback won't cause data corruption
     - Verify compatibility with current data state
     - Check for irreversible changes
     - Validate rollback testing in staging

  ## Rollback Execution
  1. **Preparation Phase:**
     - Create current state backup
     - Notify stakeholders of rollback initiation
     - Put system in maintenance mode if needed
     - Prepare monitoring and alerting

  2. **Rollback Phase:**
     - Execute rollback in predetermined order
     - Monitor system health continuously
     - Validate each step before proceeding
     - Implement checkpoints for partial rollback

  3. **Validation Phase:**
     - Verify system functionality
     - Run health checks and smoke tests
     - Validate data integrity
     - Confirm user-facing features work

  ## Monitoring & Alerting
  1. **Real-time Monitoring:**
     - System performance metrics
     - Error rates and response times
     - Database connectivity and performance
     - User experience indicators

  2. **Alert Configuration:**
     - Critical system failures
     - Performance degradation
     - Data inconsistencies
     - User impact thresholds

  ## Post-rollback Actions
  1. **System Validation:**
     - Comprehensive functionality testing
     - Performance baseline verification
     - Security posture validation
     - Integration testing with external systems

  2. **Documentation & Analysis:**
     - Document rollback execution details
     - Analyze root cause of original issue
     - Update rollback procedures based on learnings
     - Communicate status to stakeholders

  3. **Recovery Planning:**
     - Plan for re-deployment of rolled-back changes
     - Address issues that caused rollback need
     - Update testing and validation procedures
     - Improve deployment safety measures

  ## Emergency Rollback
  1. **Rapid Response:**
     - Automated rollback triggers
     - Minimal validation for critical issues
     - Emergency contact procedures
     - Escalation protocols

  2. **Communication:**
     - Immediate stakeholder notification
     - Status page updates
     - Customer communication
     - Internal team coordination

  ## Success Criteria
  - ✅ System restored to stable state
  - ✅ All critical functionality operational
  - ✅ No data loss or corruption
  - ✅ Performance metrics within normal ranges
  - ✅ User experience fully restored
  - ✅ Rollback properly documented and analyzed
