version: 1
kind: action
name: Send a Message
description: Send notifications through configured channels with rich formatting and error handling
prompt: notifyì— ë“±ë¡ëœ ë°©ë²•ì„ ì‚¬ìš©í•´ì„œ task ì™„ë£Œ ë©”ì‹œì§€ë¥¼ ë³´ë‚¸ë‹¤
enhanced-prompt: |-
  # ğŸ“± Smart Message Notification System

  **Send professional notifications through multiple channels with rich formatting.**

  ## ğŸ” Step 1: Discover Available Notification Channels
  ```bash
  echo "=== Available Notification Channels ==="

  # Check for notification configurations
  if [ -d ".taskaction/notify" ]; then
    echo "ğŸ“ Configured channels:"
    ls -la .taskaction/notify/ | grep -E '\.(yaml|yml)$' | awk '{print "  - " $9}' | sed 's/\.ya*ml$//'
  else
    echo "âš ï¸  No notification channels configured"
    echo "Run 'task-action init' to set up notification channels"
  fi
  echo ""
  ```

  ## ğŸ“ Step 2: Prepare Message Content
  ```bash
  # Get project context
  PROJECT_NAME=$(basename $(pwd))
  CURRENT_BRANCH=$(git branch --show-current 2>/dev/null || echo "unknown")
  LAST_COMMIT=$(git log -1 --pretty=format:'%h - %s' 2>/dev/null || echo "No commits")
  TIMESTAMP=$(date '+%Y-%m-%d %H:%M:%S')

  echo "=== Message Context ==="
  echo "ğŸ“ Project: $PROJECT_NAME"
  echo "ğŸŒ¿ Branch: $CURRENT_BRANCH"
  echo "ğŸ“ Last commit: $LAST_COMMIT"
  echo "â° Time: $TIMESTAMP"
  echo ""
  ```

  ## ğŸ¨ Step 3: Format Message Templates
  ```bash
  # Task completion message template
  cat << EOF > /tmp/task_completion_message.md
  ## âœ… Task Completed: $PROJECT_NAME

  **Branch:** \`$CURRENT_BRANCH\`
  **Completed:** $TIMESTAMP
  **Last Commit:** $LAST_COMMIT

  ### ğŸ“‹ Summary
  - All requirements implemented
  - Tests passing âœ…
  - Documentation updated ğŸ“–
  - Ready for review ğŸ”

  ### ğŸ”— Next Steps
  - Code review requested
  - Awaiting approval for merge
  - Deployment pending review

  ---
  *Automated notification from task-action*
  EOF

  echo "ğŸ“„ Message template created"
  ```

  ## ğŸš€ Step 4: Send to Slack (if configured)
  ```bash
  if [ -f ".taskaction/notify/slack.yaml" ]; then
    echo "ğŸ“¤ Sending to Slack..."

    # Use task-action slack command
    task-action slack send-message \
      --title "âœ… Task Completed: $PROJECT_NAME" \
      --message "$(cat /tmp/task_completion_message.md)" \
      --color "good" \
      --channel "#development"

    if [ $? -eq 0 ]; then
      echo "âœ… Slack notification sent successfully"
    else
      echo "âŒ Failed to send Slack notification"
    fi
  else
    echo "âš ï¸  Slack not configured"
  fi
  echo ""
  ```

  ## ğŸ’¬ Step 5: Send to Discord (if configured)
  ```bash
  if [ -f ".taskaction/notify/discord.yaml" ]; then
    echo "ğŸ“¤ Sending to Discord..."

    # Use task-action discord command
    task-action discord send-message \
      --title "âœ… Task Completed" \
      --description "**Project:** $PROJECT_NAME\n**Branch:** $CURRENT_BRANCH\n**Status:** Ready for review" \
      --color "3066993" \
      --footer "task-action notification"

    if [ $? -eq 0 ]; then
      echo "âœ… Discord notification sent successfully"
    else
      echo "âŒ Failed to send Discord notification"
    fi
  else
    echo "âš ï¸  Discord not configured"
  fi
  echo ""
  ```

  ## ğŸ“§ Step 6: Send Email (if configured)
  ```bash
  if [ -f ".taskaction/notify/email.yaml" ]; then
    echo "ğŸ“¤ Sending email notification..."

    # Prepare email content
    EMAIL_SUBJECT="âœ… Task Completed: $PROJECT_NAME"
    EMAIL_BODY=$(cat /tmp/task_completion_message.md)

    # Use task-action email command (if available)
    task-action email send \
      --subject "$EMAIL_SUBJECT" \
      --body "$EMAIL_BODY" \
      --to "team@company.com"

    if [ $? -eq 0 ]; then
      echo "âœ… Email notification sent successfully"
    else
      echo "âŒ Failed to send email notification"
    fi
  else
    echo "âš ï¸  Email not configured"
  fi
  echo ""
  ```

  ## ğŸ”” Step 7: Custom Webhook Notifications
  ```bash
  if [ -f ".taskaction/notify/webhook.yaml" ]; then
    echo "ğŸ“¤ Sending webhook notification..."

    # Prepare JSON payload
    cat << EOF > /tmp/webhook_payload.json
  {
    "project": "$PROJECT_NAME",
    "branch": "$CURRENT_BRANCH",
    "status": "completed",
    "timestamp": "$TIMESTAMP",
    "commit": "$LAST_COMMIT",
    "message": "Task implementation completed and ready for review"
  }
  EOF

    # Send webhook
    task-action webhook send \
      --payload /tmp/webhook_payload.json \
      --event "task.completed"

    if [ $? -eq 0 ]; then
      echo "âœ… Webhook notification sent successfully"
    else
      echo "âŒ Failed to send webhook notification"
    fi
  else
    echo "âš ï¸  Webhook not configured"
  fi
  echo ""
  ```

  ## ğŸ“Š Step 8: Notification Summary
  ```bash
  echo "=== Notification Summary ==="
  echo "ğŸ“± Channels attempted:"

  # Check which channels were attempted
  [ -f ".taskaction/notify/slack.yaml" ] && echo "  âœ… Slack" || echo "  âšª Slack (not configured)"
  [ -f ".taskaction/notify/discord.yaml" ] && echo "  âœ… Discord" || echo "  âšª Discord (not configured)"
  [ -f ".taskaction/notify/email.yaml" ] && echo "  âœ… Email" || echo "  âšª Email (not configured)"
  [ -f ".taskaction/notify/webhook.yaml" ] && echo "  âœ… Webhook" || echo "  âšª Webhook (not configured)"

  echo ""
  echo "ğŸ“ Message content:"
  echo "  - Project: $PROJECT_NAME"
  echo "  - Branch: $CURRENT_BRANCH"
  echo "  - Status: Task completed"
  echo "  - Time: $TIMESTAMP"
  echo ""
  echo "ğŸ‰ Notification workflow completed!"
  ```

  ## ğŸ› ï¸ Step 9: Troubleshooting
  ```bash
  echo "=== Troubleshooting Guide ==="
  echo ""
  echo "ğŸ”§ If notifications failed:"
  echo "1. Check notification configuration files in .taskaction/notify/"
  echo "2. Verify API tokens and webhook URLs"
  echo "3. Test connectivity to notification services"
  echo "4. Check task-action logs for detailed error messages"
  echo ""
  echo "ğŸ“– Setup help:"
  echo "- Run 'task-action init' to configure notification channels"
  echo "- Check documentation for channel-specific setup"
  echo "- Test notifications with 'task-action test-notify <channel>'"
  ```

  ## ğŸ¯ Quick Send Options
  ```bash
  # Quick Slack message
  task-action slack send-message --quick "âœ… Task completed: $PROJECT_NAME"

  # Quick Discord message
  task-action discord send-message --quick "âœ… Task completed: $PROJECT_NAME"

  # Quick notification to all configured channels
  task-action notify all --message "Task completed: $PROJECT_NAME" --type "success"
  ```

  **ğŸ“± Professional notifications sent to keep your team informed!**
