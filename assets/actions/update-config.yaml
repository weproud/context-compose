version: 1
kind: action
name: Update Configuration
description: Update project configuration files and settings
prompt: |
  Update project configuration files with proper validation and backup.

  This action helps manage configuration updates including package.json,
  environment variables, TypeScript config, and other project settings.
  It ensures configuration consistency and provides rollback capabilities
  for safe configuration management.

  Use this when updating project settings, dependencies, or environment
  configuration. The process includes backup creation, validation, and
  verification to maintain project stability during configuration changes.
enhanced-prompt: |-
  # âš™ï¸ ì„¤ì • ì—…ë°ì´íŠ¸

  ## 1ë‹¨ê³„: ì„¤ì • íŒŒì¼ ë°±ì—…
  ```bash
  echo "=== ì„¤ì • ì—…ë°ì´íŠ¸ ì‹œì‘ ==="

  # ë°±ì—… ë””ë ‰í† ë¦¬ ìƒì„±
  BACKUP_DIR="config-backup-$(date +%Y%m%d-%H%M%S)"
  mkdir -p "$BACKUP_DIR"

  # ì£¼ìš” ì„¤ì • íŒŒì¼ ë°±ì—…
  echo "ğŸ’¾ ì„¤ì • íŒŒì¼ ë°±ì—… ì¤‘..."
  [ -f "package.json" ] && cp package.json "$BACKUP_DIR/"
  [ -f "tsconfig.json" ] && cp tsconfig.json "$BACKUP_DIR/"
  [ -f ".env" ] && cp .env "$BACKUP_DIR/"
  [ -f ".env.example" ] && cp .env.example "$BACKUP_DIR/"
  [ -f "jest.config.js" ] && cp jest.config.js "$BACKUP_DIR/"
  [ -f "eslint.config.js" ] && cp eslint.config.js "$BACKUP_DIR/"
  [ -f ".eslintrc.js" ] && cp .eslintrc.js "$BACKUP_DIR/"

  echo "âœ… ë°±ì—… ì™„ë£Œ: $BACKUP_DIR"
  ```

  ## 2ë‹¨ê³„: ì„¤ì • ìœ í˜• ì„ íƒ
  ```bash
  echo "ğŸ”§ ì–´ë–¤ ì„¤ì •ì„ ì—…ë°ì´íŠ¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?"
  echo "1) package.json (ì˜ì¡´ì„±, ìŠ¤í¬ë¦½íŠ¸)"
  echo "2) TypeScript ì„¤ì • (tsconfig.json)"
  echo "3) í™˜ê²½ ë³€ìˆ˜ (.env)"
  echo "4) ESLint ì„¤ì •"
  echo "5) Jest í…ŒìŠ¤íŠ¸ ì„¤ì •"
  echo "6) ì „ì²´ ì„¤ì • ê²€í† "

  read -p "ì„ íƒ (1-6): " CONFIG_TYPE
  ```

  ## 3ë‹¨ê³„: ì„¤ì •ë³„ ì—…ë°ì´íŠ¸
  ```bash
  case "$CONFIG_TYPE" in
    1)
      echo "ğŸ“¦ package.json ì—…ë°ì´íŠ¸..."
      echo "í˜„ì¬ package.json ì •ë³´:"
      [ -f "package.json" ] && cat package.json | jq '.name, .version, .scripts' 2>/dev/null || echo "package.json íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤"
      echo ""
      echo "ì—…ë°ì´íŠ¸ ì˜µì…˜:"
      echo "- npm install <package> : ìƒˆ íŒ¨í‚¤ì§€ ì„¤ì¹˜"
      echo "- npm uninstall <package> : íŒ¨í‚¤ì§€ ì œê±°"
      echo "- npm update : íŒ¨í‚¤ì§€ ì—…ë°ì´íŠ¸"
      ;;
    2)
      echo "ğŸ”§ TypeScript ì„¤ì • ì—…ë°ì´íŠ¸..."
      if [ ! -f "tsconfig.json" ]; then
        echo "tsconfig.jsonì´ ì—†ìŠµë‹ˆë‹¤. ìƒì„±í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (y/n)"
        read -p "> " CREATE_TS
        if [ "$CREATE_TS" = "y" ]; then
          npx tsc --init
          echo "âœ… tsconfig.json ìƒì„± ì™„ë£Œ"
        fi
      else
        echo "í˜„ì¬ TypeScript ì„¤ì •:"
        cat tsconfig.json | jq '.compilerOptions.target, .compilerOptions.module' 2>/dev/null || echo "ì„¤ì • íŒŒì¼ í™•ì¸ í•„ìš”"
      fi
      ;;
    3)
      echo "ğŸŒ í™˜ê²½ ë³€ìˆ˜ ì—…ë°ì´íŠ¸..."
      echo "í˜„ì¬ .env.example:"
      [ -f ".env.example" ] && cat .env.example || echo ".env.example íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤"
      echo ""
      echo "ğŸ“ í™˜ê²½ ë³€ìˆ˜ ì¶”ê°€/ìˆ˜ì • í›„ Enterë¥¼ ëˆ„ë¥´ì„¸ìš”:"
      read
      ;;
    4)
      echo "ğŸ“ ESLint ì„¤ì • ì—…ë°ì´íŠ¸..."
      if [ ! -f ".eslintrc.js" ] && [ ! -f "eslint.config.js" ]; then
        echo "ESLint ì„¤ì •ì´ ì—†ìŠµë‹ˆë‹¤. ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (y/n)"
        read -p "> " INIT_ESLINT
        if [ "$INIT_ESLINT" = "y" ]; then
          npx eslint --init
          echo "âœ… ESLint ì„¤ì • ì™„ë£Œ"
        fi
      fi
      ;;
    5)
      echo "ğŸ§ª Jest ì„¤ì • ì—…ë°ì´íŠ¸..."
      if [ ! -f "jest.config.js" ]; then
        echo "Jest ì„¤ì •ì´ ì—†ìŠµë‹ˆë‹¤. ê¸°ë³¸ ì„¤ì •ì„ ìƒì„±í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (y/n)"
        read -p "> " CREATE_JEST
        if [ "$CREATE_JEST" = "y" ]; then
          cat > jest.config.js << EOF
  module.exports = {
    preset: 'ts-jest',
    testEnvironment: 'node',
    roots: ['<rootDir>/src', '<rootDir>/tests'],
    testMatch: ['**/*.test.ts', '**/*.spec.ts'],
    collectCoverageFrom: ['src/**/*.ts'],
    coverageDirectory: 'coverage'
  };
  EOF
          echo "âœ… Jest ì„¤ì • ìƒì„± ì™„ë£Œ"
        fi
      fi
      ;;
    6)
      echo "ğŸ” ì „ì²´ ì„¤ì • ê²€í† ..."
      echo "í”„ë¡œì íŠ¸ ì„¤ì • í˜„í™©:"
      echo "- package.json: $([ -f "package.json" ] && echo "âœ…" || echo "âŒ")"
      echo "- tsconfig.json: $([ -f "tsconfig.json" ] && echo "âœ…" || echo "âŒ")"
      echo "- .env.example: $([ -f ".env.example" ] && echo "âœ…" || echo "âŒ")"
      echo "- ESLint: $([ -f ".eslintrc.js" ] || [ -f "eslint.config.js" ] && echo "âœ…" || echo "âŒ")"
      echo "- Jest: $([ -f "jest.config.js" ] && echo "âœ…" || echo "âŒ")"
      ;;
  esac
  ```

  ## 4ë‹¨ê³„: ì„¤ì • ê²€ì¦
  ```bash
  echo "ğŸ” ì„¤ì • ê²€ì¦ ì¤‘..."

  # package.json ê²€ì¦
  if [ -f "package.json" ]; then
    node -e "JSON.parse(require('fs').readFileSync('package.json', 'utf8'))" && echo "âœ… package.json ìœ íš¨" || echo "âŒ package.json ì˜¤ë¥˜"
  fi

  # TypeScript ì„¤ì • ê²€ì¦
  if [ -f "tsconfig.json" ]; then
    npx tsc --noEmit 2>/dev/null && echo "âœ… TypeScript ì„¤ì • ìœ íš¨" || echo "âš ï¸ TypeScript ê²€ì¦ í•„ìš”"
  fi

  # ESLint ì„¤ì • ê²€ì¦
  if [ -f ".eslintrc.js" ] || [ -f "eslint.config.js" ]; then
    npm run lint 2>/dev/null && echo "âœ… ESLint ì„¤ì • ìœ íš¨" || echo "âš ï¸ ESLint ê²€ì¦ í•„ìš”"
  fi

  echo "âœ… ì„¤ì • ê²€ì¦ ì™„ë£Œ"
  ```

  ## 5ë‹¨ê³„: ë³€ê²½ì‚¬í•­ ì»¤ë°‹
  ```bash
  # ë³€ê²½ëœ íŒŒì¼ í™•ì¸
  echo "ğŸ“‹ ë³€ê²½ëœ ì„¤ì • íŒŒì¼:"
  git status --porcelain | grep -E "\.(json|js|env)$" || echo "ë³€ê²½ì‚¬í•­ ì—†ìŒ"

  # ë³€ê²½ì‚¬í•­ì´ ìˆìœ¼ë©´ ì»¤ë°‹
  if [ -n "$(git status --porcelain)" ]; then
    git add .
    git commit -m "config: update project configuration

  - Update configuration files
  - Backup created in $BACKUP_DIR
  - Settings validated and verified"
    
    echo "âœ… ì„¤ì • ë³€ê²½ì‚¬í•­ ì»¤ë°‹ ì™„ë£Œ"
  else
    echo "â„¹ï¸ ë³€ê²½ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤"
  fi

  echo "ğŸ‰ ì„¤ì • ì—…ë°ì´íŠ¸ ì™„ë£Œ!"
  echo "ğŸ“‹ ë°±ì—… ìœ„ì¹˜: $BACKUP_DIR"
  echo "ğŸ”„ ë¡¤ë°±ì´ í•„ìš”í•œ ê²½ìš°: cp $BACKUP_DIR/* ."
  ```

  **ğŸ¯ ê²°ê³¼:** ì•ˆì „í•˜ê²Œ ì—…ë°ì´íŠ¸ë˜ê³  ê²€ì¦ëœ í”„ë¡œì íŠ¸ ì„¤ì •
